<select onchange={{action (mut cardset) value="target.value"}}>
	{{#each model.cardsets as |cardset2|}}
		<option value={{cardset2.id}} selected={{eq cardset cardset2.id}}>{{cardset2.name_fr}}</option>
	{{/each}}
</select>

<p/>

<table>
	<tr>
		<td class="noborder"></td>
		{{#each model.cardclasses as |cardclass|}}
			{{#if (lt cardclass.id 12)}}
				<th class={{concat 'cardclass cardclass-' cardclass.name_fr}}>
					{{#link-to 'user.deckgroups.classdecks' (query-params cardset=cardset class=cardclass.id)}}
						{{cardclass.name_fr}}
					{{/link-to}}
				</th>
			{{/if}}
		{{/each}}
	</tr>
	{{#each model.deckgroups as |deckgroup|}}
		<tr>
			<th>
				{{#link-to 'user.deckgroups.deckgroup' deckgroup.id}}
					{{deckgroup.name}}
				{{/link-to}}
				{{#if deckgroup.url}}
					<a href={{deckgroup.url}} target="_blank">
						<i class="fas fa-external-link-alt"></i>
					</a>
				{{/if}}
			</th>
			{{#each model.cardclasses as |cardclass|}}
				{{#if (lt cardclass.id 12)}}
					{{#with (filter (action "filterCardclass" cardclass) deckgroup.decks) as |decks|}}
						{{#with decks.firstObject as |deck|}}
							<td style="background-color: hsl({{get (get deckstats deck.id) "color"}});">
								{{#link-to 'user.deck' deck.id}}
									{{deck.name}}
								{{/link-to}}
								{{#if deck.url}}
									<a href={{deck.url}} target="_blank">
										<i class="fas fa-external-link-alt"></i>
									</a>
								{{/if}}
								{{#if (gt (sub deck.dust (get (get deckstats deck.id) "dust")) 0)}}
									{{#with (filter (action "filterOwned") deck.wanteddecks) as |wanteddecks|}}
										<i class="fas fa-heart pointer" style="color: red;" {{action "removeWanteddeck" wanteddecks.firstObject}}></i>
									{{else}}
										<i class="fas fa-heart faded pointer" style="color: red;" {{action "addWanteddeck" deck}}></i>
									{{/with}}
								{{/if}}
								{{#with (filter (action "filterOwned") deck.deckstats) as |deckstats|}}
									{{#if (gt (add deckstats.firstObject.wincasual deckstats.firstObject.loosecasual) 0)}}
										{{round (div (mult 100 deckstats.firstObject.wincasual) (add deckstats.firstObject.wincasual deckstats.firstObject.loosecasual))}} %
									{{/if}}
									{{#if (gt (add deckstats.firstObject.win deckstats.firstObject.loose) 0)}}
										, {{round (div (mult 100 deckstats.firstObject.win) (add deckstats.firstObject.win deckstats.firstObject.loose))}} %
									{{/if}}
								{{/with}}
								<br/>
								{{#if deck.size}}
									{{get (get deckstats deck.id) "owned"}}/{{deck.size}}
									({{get (get deckstats deck.id) "dust"}}/{{deck.dust}})
									{{#with (sub deck.dust (get (get deckstats deck.id) "dust")) as |missing|}}
										<span class={{if (gt missing 0) "missing"}}>
											{{missing}}
										</span>
									{{/with}}
								{{/if}}
							</td>
						{{/with}}
					{{else}}
						<td></td>
					{{/with}}
				{{/if}}
			{{/each}}
		</tr>
	{{/each}}
</table>

<h3>Decks personnels</h3>

<table>
	{{#each model.cardclasses as |cardclass|}}
		{{#if (lt cardclass.id 12)}}
			<tr>
				<th class={{concat 'pointer cardclass cardclass-' cardclass.name_fr}} {{action 'createDeck' cardclass}}>
					{{cardclass.name_fr}}
				</th>
				{{#with (filter (action "filterCardclass" cardclass) model.decks) as |decks|}}
					{{#each decks as |deck|}}
						<td style="background-color: hsl({{get (get deckstats deck.id) "color"}});">
							{{#link-to 'user.deck' deck.id}}
								{{deck.name}}
							{{/link-to}}
							{{#if deck.url}}
								<a href={{deck.url}} target="_blank">
									<i class="fas fa-external-link-alt"></i>
								</a>
							{{/if}}
							{{#if (gt (sub deck.dust (get (get deckstats deck.id) "dust")) 0)}}
								{{#with (filter (action "filterOwned") deck.wanteddecks) as |wanteddecks|}}
									<i class="fas fa-heart pointer" style="color: red;" {{action "removeWanteddeck" wanteddecks.firstObject}}></i>
								{{else}}
									<i class="fas fa-heart faded pointer" style="color: red;" {{action "addWanteddeck" deck}}></i>
								{{/with}}
							{{/if}}
							{{#with (filter (action "filterOwned") deck.deckstats) as |deckstats|}}
								{{#if (gt (add deckstats.firstObject.wincasual deckstats.firstObject.loosecasual) 0)}}
									{{round (div (mult 100 deckstats.firstObject.wincasual) (add deckstats.firstObject.wincasual deckstats.firstObject.loosecasual))}} %
								{{/if}}
								{{#if (gt (add deckstats.firstObject.win deckstats.firstObject.loose) 0)}}
									, {{round (div (mult 100 deckstats.firstObject.win) (add deckstats.firstObject.win deckstats.firstObject.loose))}} %
								{{/if}}
							{{/with}}
							<br/>
							{{#if deck.size}}
								{{get (get deckstats deck.id) "owned"}}/{{deck.size}}
								({{get (get deckstats deck.id) "dust"}}/{{deck.dust}})
								{{#with (sub deck.dust (get (get deckstats deck.id) "dust")) as |missing|}}
									<span class={{if (gt missing 0) "missing"}}>
										{{missing}}
									</span>
								{{/with}}
							{{/if}}
						</td>
					{{/each}}
				{{/with}}
			</tr>
		{{/if}}
	{{/each}}
</table>
